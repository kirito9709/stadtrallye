<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Stadtrallye Ranking</title>
  <style>
    body { font-family: sans-serif; margin: 30px; }
    #loginBox { position: fixed; top: 16px; right: 300px; }
    #adminPanel { display: none; margin-bottom: 24px; }
    .hidden { display: none; }
    table { border-collapse: collapse; margin-bottom: 20px; width: 100%; max-width: 600px; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
    th { background: silver; }
    .right { float: right; }
    h2, h3 { margin-bottom: 6px; }
  </style>
</head>
<body>
  <div id="loginBox">
    <button id="loginBtn">Login</button>
  </div>
  <div id="adminPanel">
    <strong>Admin-Modus aktiv</strong>
    <button id="logoutBtn" class="right">Logout</button>
  </div>
  <h2>Ranking-Liste</h2>
  <table id="rankingTable">
    <thead><tr><th>Platz</th><th>Teamname</th><th>Punkte</th></tr></thead>
    <tbody></tbody>
  </table>
  <h3 style="margin-top:40px;">Bonuspunkte</h3>
  <table id="bonusRankingTable">
    <thead><tr><th>Platz</th><th>Teamname</th><th>Bonuspunkte</th></tr></thead>
    <tbody></tbody>
  </table>
  <h3 style="margin-top:40px;">Gesamtpunkte (Ranking + Bonus)</h3>
  <table id="totalRankingTable">
    <thead><tr><th>Platz</th><th>Teamname</th><th>Gesamtpunkte</th></tr></thead>
    <tbody></tbody>
  </table>
  <!-- Nur für Admins sichtbar -->
  <div id="adminControls" class="hidden">
    <h2>Punkte-Erfassung Ranking Team vs. Team</h2>
    <form id="scoreForm">
      <table>
        <tr>
          <td>
            <select id="teamA"></select>
          </td>
          <td>
            <!-- Minuspunkte durch min="-100" statt min="0" -->
            <input type="number" id="pointsA" min="-100" value="0" style="width:60px;">
          </td>
          <td>
            <input type="number" id="pointsB" min="-100" value="0" style="width:60px;">
          </td>
          <td>
            <select id="teamB"></select>
          </td>
          <td>
            <button type="submit">Punkte zuweisen</button>
          </td>
        </tr>
      </table>
    </form>
    <h3>Bonuspunkte-Erfassung Team vs. Team</h3>
    <form id="bonusScoreForm">
      <table>
        <tr>
          <td>
            <select id="bonusTeamA"></select>
          </td>
          <td>
            <input type="number" id="bonusPointsA" min="-100" value="0" style="width:60px;">
          </td>
          <td>
            <input type="number" id="bonusPointsB" min="-100" value="0" style="width:60px;">
          </td>
          <td>
            <select id="bonusTeamB"></select>
          </td>
          <td>
            <button type="submit">Bonuspunkte zuweisen</button>
          </td>
        </tr>
      </table>
    </form>
    <h3>Teamnamen verwalten (nur Admin)</h3>
    <div id="teamEditor">
      <ol id="teamList"></ol>
      <input type="text" id="newTeamName" placeholder="Neues Team" />
      <button id="addTeamBtn">Team hinzufügen</button>
    </div>
  </div>
<script>
// Daten dauerhaft speichern/laden
function saveData() {
  localStorage.setItem("teams", JSON.stringify(teams));
  localStorage.setItem("scores", JSON.stringify(scores));
  localStorage.setItem("bonusScores", JSON.stringify(bonusScores));
}

// Beim Laden Seite: Daten aus localStorage übernehmen (falls vorhanden)
let teams = [];
let scores = {};
let bonusScores = {};
if(localStorage.getItem('teams')){
  teams = JSON.parse(localStorage.getItem('teams'));
  scores = JSON.parse(localStorage.getItem('scores'));
  bonusScores = JSON.parse(localStorage.getItem('bonusScores'));
} else {
  // Initiale Teams anlegen (14 Stück)
  for (let i = 1; i <= 14; i++) {
    const teamName = 'Team ' + i;
    teams.push(teamName);
    scores[teamName] = 0;
    bonusScores[teamName] = 0;
  }
  saveData();
}

const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const adminPanel = document.getElementById('adminPanel');
const adminControls = document.getElementById('adminControls');
const teamEditor = document.getElementById('teamEditor');

loginBtn.onclick = () => {
  const u = prompt("Benutzername:");
  const p = prompt("Passwort:");
  if (u === "admin" && p === "admin") {
    adminPanel.style.display = "block";
    loginBtn.style.display = "none";
    adminControls.classList.remove('hidden');
    updateTeamList();
    updateTeamDropdowns();
  } else {
    alert("Falsche Zugangsdaten!");
  }
};
logoutBtn.onclick = () => {
  adminPanel.style.display = "none";
  loginBtn.style.display = "inline-block";
  adminControls.classList.add('hidden');
};
// Teamnamen editieren & anzeigen
function updateTeamList() {
  const list = document.getElementById('teamList');
  list.innerHTML = '';
  teams.forEach((t, i) => {
    const li = document.createElement('li');
    li.innerHTML = `<input value="${t}" data-idx="${i}" style="width: 160px;"> 
                    <button onclick="removeTeam(${i})">X</button>`;
    list.appendChild(li);
  });
  document.querySelectorAll('#teamList input').forEach(inp => {
    inp.onchange = (e) => {
      const idx = e.target.dataset.idx;
      const oldName = teams[idx];
      const newName = e.target.value.trim() || oldName;
      // Namen ändern und Punkte übertragen
      teams[idx] = newName;
      if(scores[oldName] !== undefined) {
        scores[newName] = scores[oldName];
        delete scores[oldName];
      }
      if(bonusScores[oldName] !== undefined){
        bonusScores[newName] = bonusScores[oldName];
        delete bonusScores[oldName];
      }
      updateRanking();
      updateBonusRanking();
      updateTotalRanking();
      updateTeamDropdowns();
      updateTeamList();
      saveData();
    };
  });
}
window.removeTeam = function(idx) {
  const oldName = teams[idx];
  teams.splice(idx, 1);
  delete scores[oldName];
  delete bonusScores[oldName];
  updateRanking();
  updateBonusRanking();
  updateTotalRanking();
  updateTeamDropdowns();
  updateTeamList();
  saveData();
};
document.getElementById('addTeamBtn').onclick = function() {
  const tn = document.getElementById('newTeamName').value.trim();
  if (tn && !teams.includes(tn)) {
    teams.push(tn);
    scores[tn] = 0;
    bonusScores[tn] = 0;
    updateRanking();
    updateBonusRanking();
    updateTotalRanking();
    updateTeamDropdowns();
    updateTeamList();
    document.getElementById('newTeamName').value = "";
    saveData();
  }
};
// Ranking Tabelle aktualisieren
function updateRanking() {
  const sorted = teams.slice().sort((a,b) => scores[b] - scores[a] || a.localeCompare(b));
  const tbody = document.querySelector('#rankingTable tbody');
  tbody.innerHTML = "";
  sorted.forEach((team, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${idx+1}</td><td>${team}</td><td>${scores[team]}</td>`;
    tbody.appendChild(tr);
  });
  saveData();
}
// Bonus Ranking Tabelle aktualisieren
function updateBonusRanking() {
  const sorted = teams.slice().sort((a,b) => bonusScores[b] - bonusScores[a] || a.localeCompare(b));
  const tbody = document.querySelector('#bonusRankingTable tbody');
  tbody.innerHTML = "";
  sorted.forEach((team, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${idx+1}</td><td>${team}</td><td>${bonusScores[team]}</td>`;
    tbody.appendChild(tr);
  });
  saveData();
}
// Gesamtranking Tabelle (Summe)
function updateTotalRanking() {
  // Punkte addieren und sortieren
  const totalPoints = {};
  teams.forEach(t => {
    totalPoints[t] = (scores[t] || 0) + (bonusScores[t] || 0);
  });
  const sorted = teams.slice().sort((a,b) => totalPoints[b] - totalPoints[a] || a.localeCompare(b));
  const tbody = document.querySelector('#totalRankingTable tbody');
  tbody.innerHTML = "";
  sorted.forEach((team, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${idx+1}</td><td>${team}</td><td>${totalPoints[team]}</td>`;
    tbody.appendChild(tr);
  });
  saveData();
}
// Dropdowns für Punktevergabe aktualisieren (jeweils Ranking und Bonus)
function updateTeamDropdowns() {
  const selectors = ['teamA', 'teamB', 'bonusTeamA', 'bonusTeamB'];
  selectors.forEach(id => {
    const select = document.getElementById(id);
    select.innerHTML = '';
    teams.forEach(t => {
      select.innerHTML += `<option value="${t}">${t}</option>`;
    });
  });
  saveData();
}
// Punktevergabe Formular Aktionen (Ranking)
document.getElementById('scoreForm').onsubmit = function(e) {
  e.preventDefault();
  const teamA = document.getElementById('teamA').value;
  const teamB = document.getElementById('teamB').value;
  const pointsA = parseInt(document.getElementById('pointsA').value, 10) || 0;
  const pointsB = parseInt(document.getElementById('pointsB').value, 10) || 0;
  if (teamA === teamB) {
    alert("Teams müssen unterschiedlich sein!");
    return;
  }
  scores[teamA] += pointsA;
  scores[teamB] += pointsB;
  updateRanking();
  updateTotalRanking();
  saveData();
};
// Punktevergabe Formular Aktionen (Bonus)
document.getElementById('bonusScoreForm').onsubmit = function(e) {
  e.preventDefault();
  const teamA = document.getElementById('bonusTeamA').value;
  const teamB = document.getElementById('bonusTeamB').value;
  const pointsA = parseInt(document.getElementById('bonusPointsA').value, 10) || 0;
  const pointsB = parseInt(document.getElementById('bonusPointsB').value, 10) || 0;
  if (teamA === teamB) {
    alert("Teams müssen unterschiedlich sein!");
    return;
  }
  bonusScores[teamA] += pointsA;
  bonusScores[teamB] += pointsB;
  updateBonusRanking();
  updateTotalRanking();
  saveData();
};
// Initial render
updateRanking();
updateBonusRanking();
updateTotalRanking();
updateTeamList();
updateTeamDropdowns();
</script>
</body>
</html>







